
Option Explicit

Public SelectedSpecialCharCols As Collection
Public SelectedNoNumberCols As Collection
Public SelectedEmailCols As Collection

Private Sub UserForm_Initialize()

    Dim ws As Worksheet
    Dim lastCol As Long
    Dim j As Long
    Dim headerName As String

    Set ws = ThisWorkbook.Sheets("Sheet1")
    lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column

    ' ===== DEFAULT COLUMN NAMES (EDIT FREELY) =====
    Dim defSpecial, defNoNum, defEmail
    defSpecial = Array("Customer_Name", "Address_Line1", "Address_Line2")
    defNoNum = Array("Customer_Name", "City", "State")
    defEmail = Array("Email", "Customer_Email")

    For j = 1 To lastCol
        headerName = Trim(ws.Cells(1, j).Value)
        If headerName <> "" Then
            LstSpecialChar.AddItem headerName
            LstNoNumbers.AddItem headerName
            LstEmail.AddItem headerName

            PreSelect LstSpecialChar, headerName, defSpecial
            PreSelect LstNoNumbers, headerName, defNoNum
            PreSelect LstEmail, headerName, defEmail
        End If
    Next j

End Sub

Private Sub btnRun_Click()

    Dim i As Long

    Set SelectedSpecialCharCols = New Collection
    Set SelectedNoNumberCols = New Collection
    Set SelectedEmailCols = New Collection

    For i = 0 To LstSpecialChar.ListCount - 1
        If LstSpecialChar.Selected(i) Then
            SelectedSpecialCharCols.Add LstSpecialChar.List(i)
        End If
    Next i

    For i = 0 To LstNoNumbers.ListCount - 1
        If LstNoNumbers.Selected(i) Then
            SelectedNoNumberCols.Add LstNoNumbers.List(i)
        End If
    Next i

    For i = 0 To LstEmail.ListCount - 1
        If LstEmail.Selected(i) Then
            SelectedEmailCols.Add LstEmail.List(i)
        End If
    Next i

    Me.Hide
End Sub

Private Sub btnCancel_Click()
    Set SelectedSpecialCharCols = Nothing
    Set SelectedNoNumberCols = Nothing
    Set SelectedEmailCols = Nothing
    Me.Hide
End Sub

' ===== Helper to preselect defaults =====
Private Sub PreSelect(lst As MSForms.ListBox, val As String, arr As Variant)
    Dim i As Long
    For i = LBound(arr) To UBound(arr)
        If LCase(val) = LCase(arr(i)) Then
            lst.Selected(lst.ListCount - 1) = True
            Exit Sub
        End If
    Next i
End Sub
